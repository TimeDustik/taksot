<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>–ê–¥–º—ñ–Ω | –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è</title>
</head>
<body class="bg-light text-dark">
<nav class="navbar navbar-dark bg-dark mb-4 shadow">
    <div class="container">
        <span class="navbar-brand fw-bold">ADMIN PANEL</span>
        <a href="/logout" class="btn btn-danger btn-sm">–í–∏–π—Ç–∏</a>
    </div>
</nav>

<div class="container">
    {% with messages = get_flashed_messages() %}
      {% if messages %}
        {% for m in messages %}<div class="alert alert-info py-2 small">{{ m }}</div>{% endfor %}
      {% endif %}
    {% endwith %}

    <div class="row">
        <div class="col-md-4">
            <div class="card shadow-sm border-0 p-3 mb-4">
                <h5 class="fw-bold">–ù–æ–≤–∏–π –∞–∫–∞—É–Ω—Ç</h5>
                <form action="/create_user" method="POST">
                    <input type="text" name="username" class="form-control mb-2" placeholder="–õ–æ–≥—ñ–Ω" required>
                    <select name="role" class="form-select mb-2">
                        <option value="l1">L1 –°–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫</option>
                        <option value="teamlead">–¢–∏–º–ª—ñ–¥–µ—Ä</option>
                    </select>
                    <input type="text" name="card_number" class="form-control mb-2" placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç–∏">
                    <select name="leader_id" class="form-select mb-3">
                        <option value="">–ë–µ–∑ –¢–∏–º–ª—ñ–¥–∞</option>
                        {% for tl in teamleads %}<option value="{{ tl.id }}">{{ tl.username }}</option>{% endfor %}
                    </select>
                    <button type="submit" class="btn btn-primary w-100">–°—Ç–≤–æ—Ä–∏—Ç–∏</button>
                </form>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-white fw-bold">–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ —Å–∏—Å—Ç–µ–º–∏</div>
                <div class="card-body p-0">
                    <table class="table align-middle mb-0">
                        <thead><tr><th>–†–æ–ª—å/–Ü–º'—è</th><th>–ö–∞—Ä—Ç–∞/–ö–µ—Ä—ñ–≤–Ω–∏–∫</th><th>–î—ñ—ó</th></tr></thead>
                        <tbody>
                            {% for u in users %}
                            <tr class="{% if u.role == 'teamlead' %}table-info{% endif %}">
                                <td>
                                    <span class="badge bg-secondary small">{{ u.role }}</span><br>
                                    <strong>{{ u.username }}</strong>
                                </td>
                                <td>
                                    <small>{{ u.card_number or '---' }}</small><br>
                                    <small class="text-muted">TL: {{ u.leader.username if u.leader else '–Ω–µ–º–∞—î' }}</small>
                                </td>
                                <td>
                                    <div class="btn-group">
                                        <button class="btn btn-sm btn-outline-primary" data-bs-toggle="collapse" data-bs-target="#editU{{ u.id }}">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                                        <form action="/reset_password/{{ u.id }}" method="POST" onsubmit="return confirm('–°–∫–∏–Ω—É—Ç–∏ –ø–∞—Ä–æ–ª—å?')">
                                            <button class="btn btn-sm btn-outline-warning">–°–∫–∏–Ω—É—Ç–∏ –∫–ª—é—á</button>
                                        </form>
                                        <a href="/user_history/{{ u.id }}" class="btn btn-sm btn-outline-dark">üìú</a>
                                    </div>
                                    <div class="collapse mt-2" id="editU{{ u.id }}">
                                        <form action="/edit_user/{{ u.id }}" method="POST" class="p-2 border rounded bg-white shadow-sm">
                                            <input type="text" name="username" value="{{ u.username }}" class="form-control mb-1 shadow-none">
                                            <select name="role" class="form-select mb-1 shadow-none">
                                                <option value="l1" {% if u.role=='l1' %}selected{% endif %}>L1</option>
                                                <option value="teamlead" {% if u.role=='teamlead' %}selected{% endif %}>Teamlead</option>
                                            </select>
                                            <input type="text" name="card_number" value="{{ u.card_number }}" class="form-control mb-1 shadow-none">
                                            <select name="leader_id" class="form-select mb-2 shadow-none">
                                                <option value="">–ë–µ–∑ –¢–∏–º–ª—ñ–¥–∞</option>
                                                {% for tl in teamleads %}
                                                <option value="{{ tl.id }}" {% if u.leader_id == tl.id %}selected{% endif %}>{{ tl.username }}</option>
                                                {% endfor %}
                                            </select>
                                            <button class="btn btn-sm btn-success w-100">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>