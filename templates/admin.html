<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Адмін-панель</title>
    <style>
        body { background-color: #f4f7f6; font-family: 'Segoe UI', sans-serif; }
        .card { border: none; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .edit-form { display: none; margin-top: 15px; padding: 20px; background: #fff; border-radius: 12px; border: 1px solid #eee; }
        .btn-round { border-radius: 30px; }
    </style>
</head>
<body>

<nav class="navbar navbar-dark bg-dark mb-4 shadow">
    <div class="container">
        <span class="navbar-brand fw-bold">⚙️ ADMIN PANEL</span>
        <a href="/logout" class="btn btn-outline-danger btn-sm btn-round px-3">Вийти</a>
    </div>
</nav>

<div class="container">
    {% with messages = get_flashed_messages() %}
      {% if messages %}{% for msg in messages %}<div class="alert alert-success rounded-pill text-center shadow-sm">{{ msg }}</div>{% endfor %}{% endif %}
    {% endwith %}

    <div class="row">
        <div class="col-md-4">
            <div class="card p-4 mb-4">
                <h5 class="fw-bold mb-3">Новий акаунт</h5>
                <form action="/create_user" method="POST">
                    <input type="text" name="username" class="form-control mb-2 rounded-3" placeholder="Логін" required>
                    <select name="role" class="form-select mb-2 rounded-3">
                        <option value="l1">L1 Співробітник</option>
                        <option value="teamlead">Тимлід</option>
                    </select>
                    <input type="text" name="city" class="form-control mb-2 rounded-3" placeholder="Місто роботи" required>
                    <input type="text" name="card_number" class="form-control mb-2 rounded-3" placeholder="Номер карти">
                    <select name="leader_id" class="form-select mb-3 rounded-3">
                        <option value="">Без Тимліда</option>
                        {% for tl in teamleads %}<option value="{{ tl.id }}">{{ tl.username }}</option>{% endfor %}
                    </select>
                    <button type="submit" class="btn btn-primary w-100 fw-bold btn-round shadow-sm">Створити</button>
                </form>
            </div>
        </div>

        <div class="col-md-8">
            <div class="card p-3 shadow-sm">
                <h5 class="fw-bold mb-3 ms-2">Користувачі системи</h5>
                <table class="table align-middle">
                    <thead class="table-light small text-uppercase">
                        <tr><th>Роль/Логін</th><th>Місто/Карта</th><th class="text-end">Дії</th></tr>
                    </thead>
                    <tbody>
                        {% for u in users %}
                        <tr>
                            <td>
                                <span class="badge bg-secondary mb-1" style="font-size: 10px;">{{ u.role | upper }}</span><br>
                                <strong>{{ u.username }}</strong>
                            </td>
                            <td>
                                <div class="small fw-bold text-primary">{{ u.city }}</div>
                                <div class="text-muted small">{{ u.card_number }}</div>
                            </td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-outline-primary btn-round px-3" onclick="toggleEdit('{{ u.id }}')">Редагувати</button>

                                <form action="/reset_password/{{ u.id }}" method="POST" class="d-inline">
                                    <button type="submit" class="btn btn-sm btn-outline-warning btn-round px-3 shadow-sm">Скинути ключ</button>
                                </form>

                                <div id="edit-{{ u.id }}" class="edit-form text-start shadow">
                                    <form action="/edit_user/{{ u.id }}" method="POST">
                                        <input type="text" name="username" value="{{ u.username }}" class="form-control mb-2 rounded-3">
                                        <input type="text" name="city" value="{{ u.city }}" class="form-control mb-2 rounded-3">
                                        <input type="text" name="card_number" value="{{ u.card_number }}" class="form-control mb-2 rounded-3">
                                        <button type="submit" class="btn btn-sm btn-success w-100 btn-round mt-2">Зберегти</button>
                                    </form>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    function toggleEdit(id) {
        const f = document.getElementById('edit-' + id);
        f.style.display = (f.style.display === 'block') ? 'none' : 'block';
    }
</script>
</body>
</html>